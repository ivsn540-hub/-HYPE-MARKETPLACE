–º<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å —Å–æ–±—ã—Ç–∏–π | HYPE MARKETPLACE</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {background:#262D47;color:#fff;font-family:'Montserrat',Arial,sans-serif;margin:0;padding:18px;}
    h1 {color:gold;text-align:center;margin-top:18px;font-size:2em;font-weight:bold;}
    h2 {color:#FFD700;margin:32px 0 18px 0;font-size:1.16em;}
    .cards {display:flex;flex-wrap:wrap;gap:20px;justify-content:center;}
    .card {background:#32395C;border-radius:13px;box-shadow:0 6px 26px #181A2B;padding:17px;width:97vw;max-width:320px;display:flex;flex-direction:column;align-items:center;}
    .card img {width:110px;height:110px;border-radius:50%;object-fit:cover;border:3px solid gold;margin-bottom:13px;}
    .card h3{color:gold;font-size:1.1em;margin-bottom:5px;font-weight:bold;}
    .card .skills{color:orange;font-size:.93em;margin-bottom:7px;}
    .card .desc{font-size:0.95em;color:#eee;text-align:center;margin-bottom:8px;}
    .card .price{color:#FFD700;font-weight:bold;margin-bottom:8px;}
    .chat-btn {background:#fff;color:#32395C;border-radius:6px;padding:7px 15px;font-size:0.98em;margin:5px 0;border:none;cursor:pointer;}
    .pay-btn {background:gold;color:#23253a;border-radius:9px;font-weight:bold;padding:11px 19px;box-shadow:0 2px 14px #333;margin-top:10px;margin-bottom:8px;cursor:pointer;border:none;}
    .artist-cal {background:#23244a;color:#FFD700;border-radius:6px;padding:8px 15px;font-size:0.96em;margin-top:6px;margin-bottom:7px;text-align:center;}
    audio {width:95%;margin-bottom:3px;}
    .cab-btn {background:gold;color:#23244a;border-radius:8px;padding:9px 20px;font-weight:bold;cursor:pointer;border:none;}
    table.order-history{width:100%;background:#1e1f2f;color:#FFD700;border-radius:8px;margin-top:15px;font-size:0.97em;}
    table.order-history th,table.order-history td{padding:6px 3px;font-size:0.95em;}
    table.order-history th{font-weight:bold;}
    .ext-links a{color:deepskyblue;text-decoration:underline;padding:0 7px;}
    #popupNotif {position:fixed;bottom:25px;left:50%;transform:translateX(-50%);background:#FFD700;color:#23253a;font-weight:bold;padding:12px 19px;border-radius:9px;display:none;z-index:9000;}
    .stars{color:gold;font-size:1.18em;padding:5px;}
    .admin-btn,.exp-btn {background:#FFD700;color:#1c222d;padding:8px 15px;border-radius:8px;font-weight:bold;margin:5px;border:none;cursor:pointer;}
    .portfolio{margin:5px 0 10px 0;text-align:center;}
    @media(max-width:520px){.card{max-width:98vw;padding:10px;}.cab-btn{padding:10px 7vw;}}
  </style>
</head>
<body>
  <div style="text-align:right;margin-bottom:18px;">
    <button id="profileBtn" onclick="showProfileModal()" class="cab-btn">–í–æ–π—Ç–∏</button>
    <button class="exp-btn" onclick="exportAllCSV()">–≠–∫—Å–ø–æ—Ä—Ç CSV</button>
    <button class="admin-btn" onclick="showAdminPanel()">–ê–¥–º–∏–Ω–∫–∞</button>
    <button class="cab-btn" onclick="toggleTheme()">–¢–µ–º–∞</button>
  </div>
  <h1>–ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å —Å–æ–±—ã—Ç–∏–π | HYPE MARKETPLACE</h1>
  <div id="themeWarn" style="text-align:center;color:#FFD700;font-size:1.1em"></div>

  <h2>–í–µ–¥—É—â–∏–µ</h2>
  <div class="cards">
    <div class="card" id="card-ved">
      <img src="images/vedushaya.jpg" alt="–û–ª—å–≥–∞ –û—Å–∏–ø–æ–≤–∞">
      <h3>–û–ª—å–≥–∞ –û—Å–∏–ø–æ–≤–∞</h3>
      <div class="skills">MC, —à–æ—É, –≤–æ–∫–∞–ª, –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤—ã</div>
      <div class="desc">–≠–∫—Å–∫–ª—é–∑–∏–≤, –æ–ø—ã—Ç 5+ –ª–µ—Ç.</div>
      <div class="stars" id="star-ved">–ù–µ—Ç –æ—Ü–µ–Ω–æ–∫</div>
      <div class="portfolio">
        <b>–ü–æ—Ä—Ç—Ñ–æ–ª–∏–æ:</b>
        <a href="files/olga_video.mp4" target="_blank">–í–∏–¥–µ–æ</a>
        <a href="files/olga_review.pdf" target="_blank">–û—Ç–∑—ã–≤—ã</a>
      </div>
      <div class="artist-cal" id="cal-ved"></div>
      <div class="price">2000 ‚ÇΩ</div>
      <audio controls><source src="music/pelet-pelet.mp3"></audio>
      <div class="ext-links">
        <a href="https://t.me/olga_ostg" target="_blank">Telegram</a>
        <a href="https://vk.com/olga_ostg" target="_blank">VK</a>
        <a href="https://wa.me/79123456789" target="_blank">WhatsApp</a>
        <a href="mailto:artist@hype.com">–ü–æ—á—Ç–∞</a>
      </div>
      <button class="pay-btn" onclick="openModal('ved')">–ó–∞—è–≤–∫–∞ + –û–ø–ª–∞—Ç–∞ 2000‚ÇΩ</button>
    </div>
    <div class="card" id="card-ved2">
      <img src="images/default.jpg" alt="–î–º–∏—Ç—Ä–∏–π –®–∞—Ä–∞–ø">
      <h3>–î–º–∏—Ç—Ä–∏–π –®–∞—Ä–∞–ø</h3>
      <div class="skills">–°–≤–∞–¥—å–±—ã, –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤—ã, —Ä–∞–¥–∏–æ</div>
      <div class="desc">8+ –ª–µ—Ç –æ–ø—ã—Ç–∞. –ì–∞—Ä–∞–Ω—Ç–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.</div>
      <div class="stars" id="star-ved2">–ù–µ—Ç –æ—Ü–µ–Ω–æ–∫</div>
      <div class="portfolio">
        <b>–ü–æ—Ä—Ç—Ñ–æ–ª–∏–æ:</b>
        <a href="files/sharap_evt.mp4" target="_blank">–í–∏–¥–µ–æ</a>
      </div>
      <div class="artist-cal" id="cal-ved2"></div>
      <div class="price">1800 ‚ÇΩ</div>
      <audio controls><source src="music/dmitry.mp3"></audio>
      <div class="ext-links">
        <a href="https://t.me/dsharap" target="_blank">Telegram</a>
        <a href="https://vk.com/sharap_d" target="_blank">VK</a>
      </div>
      <button class="pay-btn" onclick="openModal('ved2')">–ó–∞—è–≤–∫–∞ + –û–ø–ª–∞—Ç–∞ 1800‚ÇΩ</button>
    </div>
  </div>

  <h2>–î–∏–¥–∂–µ–∏</h2>
  <div class="cards">
    <div class="card" id="card-dj">
      <img src="images/dj1.jpg" alt="DJ Alex Wave">
      <h3>DJ –ê–ª–µ–∫—Å Wave</h3>
      <div class="skills">House, Pop, Tech</div>
      <div class="desc">10+ –ª–µ—Ç –Ω–∞ —Å—Ü–µ–Ω–µ.</div>
      <div class="stars" id="star-dj">–ù–µ—Ç –æ—Ü–µ–Ω–æ–∫</div>
      <div class="artist-cal" id="cal-dj"></div>
      <div class="price">1400 ‚ÇΩ</div>
      <audio controls><source src="music/dj1.mp3"></audio>
      <div class="ext-links">
        <a href="https://t.me/djalexwave" target="_blank">Telegram</a>
      </div>
      <button class="pay-btn" onclick="openModal('dj')">–ó–∞—è–≤–∫–∞ + –û–ø–ª–∞—Ç–∞ 1400‚ÇΩ</button>
    </div>
    <div class="card" id="card-dj2">
      <img src="images/dj2.jpg" alt="DJ Lera Sound">
      <h3>DJ –õ–µ—Ä–∞ Sound</h3>
      <div class="skills">R&B, POP, Disco</div>
      <div class="desc">–ö–ª—É–±—ã, —Å–≤–∞–¥—å–±—ã.</div>
      <div class="stars" id="star-dj2">–ù–µ—Ç –æ—Ü–µ–Ω–æ–∫</div>
      <div class="artist-cal" id="cal-dj2"></div>
      <div class="price">1100 ‚ÇΩ</div>
      <audio controls><source src="music/dj2.mp3"></audio>
      <button class="pay-btn" onclick="openModal('dj2')">–ó–∞—è–≤–∫–∞ + –û–ø–ª–∞—Ç–∞ 1100‚ÇΩ</button>
    </div>
  </div>

  <h2>–ú—É–∑—ã–∫–∞–Ω—Ç—ã</h2>
  <div class="cards">
    <div class="card" id="card-mus">
      <img src="images/music1.jpg" alt="–¢—Ä–∏–æ Viva Music">
      <h3>–¢—Ä–∏–æ Viva Music</h3>
      <div class="skills">–°–∫—Ä–∏–ø–∫–∞, —Ñ–æ—Ä—Ç–µ–ø–∏–∞–Ω–æ, –≤–æ–∫–∞–ª</div>
      <div class="desc">–õ–∞—É—Ä–µ–∞—Ç—ã –∫–æ–Ω–∫—É—Ä—Å–æ–≤</div>
      <div class="stars" id="star-mus">–ù–µ—Ç –æ—Ü–µ–Ω–æ–∫</div>
      <div class="portfolio">
        <b>–ü–æ—Ä—Ç—Ñ–æ–ª–∏–æ:</b>
        <a href="files/viva_concert.mp4" target="_blank">–ö–æ–Ω—Ü–µ—Ä—Ç</a>
      </div>
      <div class="artist-cal" id="cal-mus"></div>
      <div class="price">1500 ‚ÇΩ</div>
      <audio controls><source src="music/music1.mp3"></audio>
      <div class="ext-links">
        <a href="https://t.me/vivamusic" target="_blank">Telegram</a>
        <a href="https://vk.com/viva_music" target="_blank">VK</a>
      </div>
      <button class="pay-btn" onclick="openModal('mus')">–ó–∞—è–≤–∫–∞ + –û–ø–ª–∞—Ç–∞ 1500‚ÇΩ</button>
    </div>
    <div class="card" id="card-mus2">
      <img src="images/music2.jpg" alt="–ó–æ–ª–æ—Ç–æ–π –°–∞–∫—Å–æ—Ñ–æ–Ω">
      <h3>–ó–æ–ª–æ—Ç–æ–π –°–∞–∫—Å–æ—Ñ–æ–Ω</h3>
      <div class="skills">–°–∞–∫—Å–æ—Ñ–æ–Ω, –¥–∂–∞–∑, –±–ª—é–∑</div>
      <div class="desc">–ü–æ–±–µ–¥–∏—Ç–µ–ª—å —à–æ—É, –∞–≤—Ç–æ—Ä—Å–∫–∏–µ –∞—Ä–∞–Ω–∂–∏—Ä–æ–≤–∫–∏.</div>
      <div class="stars" id="star-mus2">–ù–µ—Ç –æ—Ü–µ–Ω–æ–∫</div>
      <div class="artist-cal" id="cal-mus2"></div>
      <div class="price">1700 ‚ÇΩ</div>
      <audio controls><source src="music/music2.mp3"></audio>
      <div class="ext-links">
        <a href="https://t.me/goldensax" target="_blank">Telegram</a>
      </div>
      <button class="pay-btn" onclick="openModal('mus2')">–ó–∞—è–≤–∫–∞ + –û–ø–ª–∞—Ç–∞ 1700‚ÇΩ</button>
    </div>
  </div>

  <h2>–ê–≥–µ–Ω—Ç—ã</h2>
  <div class="cards">
    <div class="card" id="card-agent">
      <img src="images/agent1.jpg" alt="–ò—Ä–∏–Ω–∞ MIR">
      <h3>–ò—Ä–∏–Ω–∞ MIR</h3>
      <div class="skills">–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π</div>
      <div class="desc">10+ –ª–µ—Ç –ø—Ä–∞–∫—Ç–∏–∫–∏.</div>
      <div class="stars" id="star-agent">–ù–µ—Ç –æ—Ü–µ–Ω–æ–∫</div>
      <div class="portfolio">
        <b>–ü–æ—Ä—Ç—Ñ–æ–ª–∏–æ:</b>
        <a href="files/mir_events.pdf" target="_blank">–°–æ–±—ã—Ç–∏—è</a>
      </div>
      <div class="artist-cal" id="cal-agent"></div>
      <div class="price">2400 ‚ÇΩ</div>
      <div class="ext-links">
        <a href="https://t.me/irinamir" target="_blank">Telegram</a>
        <a href="https://vk.com/mir_events" target="_blank">VK</a>
      </div>
      <button class="pay-btn" onclick="openModal('agent')">–ó–∞—è–≤–∫–∞ + –û–ø–ª–∞—Ç–∞ 2400‚ÇΩ</button>
    </div>
    <div class="card" id="card-agent2">
      <img src="images/agent2.jpg" alt="–ú–∞–∫—Å–∏–º Event">
      <h3>–ú–∞–∫—Å–∏–º Event</h3>
      <div class="skills">–ê–≥–µ–Ω—Ç—Å–∫–∏–µ —É—Å–ª—É–≥–∏</div>
      <div class="desc">–ü–æ–¥–±–æ—Ä –∞—Ä—Ç–∏—Å—Ç–æ–≤.</div>
      <div class="stars" id="star-agent2">–ù–µ—Ç –æ—Ü–µ–Ω–æ–∫</div>
      <div class="artist-cal" id="cal-agent2"></div>
      <div class="price">1800 ‚ÇΩ</div>
      <div class="ext-links">
        <a href="https://t.me/maxevent" target="_blank">Telegram</a>
      </div>
      <button class="pay-btn" onclick="openModal('agent2')">–ó–∞—è–≤–∫–∞ + –û–ø–ª–∞—Ç–∞ 1800‚ÇΩ</button>
    </div>
  </div>

  <div id="popupNotif"></div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∑–∞—è–≤–∫–∏ + –æ–ø–ª–∞—Ç—ã -->
  <div id="modal-pay-all" style="display:none;position:fixed;left:0;top:0;width:100vw;height:100vh;background:rgba(30,30,40,0.92);z-index:5000;">
    <div style="max-width:340px;margin:90px auto;background:#32395C;padding:26px 18px;border-radius:15px;box-shadow:0 6px 24px #181A2B;">
      <h2 style="color:gold;">–ó–∞—è–≤–∫–∞ –∏ –æ–Ω–ª–∞–π–Ω –æ–ø–ª–∞—Ç–∞</h2>
      <form id="universalForm" onsubmit="event.preventDefault();document.getElementById('paybox-tinkoff-all').style.display='block';">
        <input type="text" id="clientName" placeholder="–ò–º—è" required style="width:98%;margin-bottom:10px;padding:9px;">
        <input type="email" id="clientEmail" placeholder="E-mail" required style="width:98%;margin-bottom:10px;padding:9px;">
        <input type="tel" id="clientPhone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" required style="width:98%;margin-bottom:10px;padding:9px;">
        <select id="clientDate" required style="width:98%;margin-bottom:12px;padding:9px;">
          <option>–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É</option>
        </select>
        <button style="background:gold;color:#23253a;border-radius:8px;padding:9px 18px;border:none;">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
      </form>
      <div id="paybox-tinkoff-all" style="display:none;margin-top:17px;">
        <form action="https://securepay.tinkoff.ru/invoice/..." method="POST" target="_blank" id="payForm">
          <input type="hidden" name="terminalkey" value="–¢–í–û–ô_TERMINAL_KEY">
          <input type="hidden" name="amount" id="payAmount">
          <input type="hidden" name="description" id="payComment">
          <input type="hidden" name="name" id="payClientName">
          <input type="hidden" name="email" id="payClientEmail">
          <input type="hidden" name="phone" id="payClientPhone">
          <button type="submit" style="background:gold;color:#23253a;border-radius:8px;padding:10px 28px;border:none;" id="payBtn"></button>
        </form>
      </div>
      <button onclick="document.getElementById('modal-pay-all').style.display='none';document.getElementById('paybox-tinkoff-all').style.display='none';" style="margin-top:23px;background:#262D47;color:#FFD700;border-radius:6px;padding:9px 20px;border:none;">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Ñ–∏–ª—è -->
  <div id="profileModal" style="display:none;position:fixed;left:0;top:0;width:100vw;height:100vh;background:rgba(30,30,40,0.97);z-index:30000;">
    <div style="max-width:370px;margin:70px auto;background:#32395C;padding:30px 20px;border-radius:12px;box-shadow:0 12px 32px #191a2b;">
      <div id="authBlock"></div>
      <button onclick="hideProfileModal()" style="margin-top:17px;background:#262D47;color:#FFD700;border-radius:6px;padding:8px 22px;border:none;">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —á–∞—Ç–∞ -->
  <div id="chatModal" style="display:none;position:fixed;left:0;top:0;width:100vw;height:100vh;background:rgba(26,26,36,0.97);z-index:40000;">
    <div style="max-width:380px;margin:70px auto;background:#32395C;padding:23px 20px;border-radius:12px;box-shadow:0 12px 32px #191a2b;">
      <h2 style="color:gold;">–ß–∞—Ç —Å –∞—Ä—Ç–∏—Å—Ç–æ–º</h2>
      <div id="chatBox" style="height:200px;overflow-y:auto;background:#23253a;padding:10px;border-radius:8px;margin-bottom:10px;"></div>
      <input type="text" id="chatMsg" placeholder="–í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." style="width:99%;margin:8px 0 13px 0;padding:9px;">
      <button onclick="sendChatMsg()" style="width:100%;background:gold;color:#23243a;border-radius:7px;font-weight:bold;border:none;padding:10px;">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      <button onclick="hideChatModal()" style="margin-top:17px;background:#262D47;color:#FFD700;border-radius:6px;padding:8px 22px;border:none;">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
  </div>

  <script>
    const serviceList = {
      ved:   {amount:200000,comment:'–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–µ–¥—É—â–µ–≥–æ –û–ª—å–≥–∞ –û—Å–∏–ø–æ–≤–∞ (2000 —Ä—É–±)',btnText:'–û–ø–ª–∞—Ç–∏—Ç—å –±—Ä–æ–Ω—å (2000 —Ä—É–±)'},
      ved2:  {amount:180000,comment:'–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–µ–¥—É—â–µ–≥–æ –î–º–∏—Ç—Ä–∏–π –®–∞—Ä–∞–ø (1800 —Ä—É–±)',btnText:'–û–ø–ª–∞—Ç–∏—Ç—å –±—Ä–æ–Ω—å (1800 —Ä—É–±)'},
      dj:    {amount:140000,comment:'–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ DJ Alex Wave (1400 —Ä—É–±)',btnText:'–û–ø–ª–∞—Ç–∏—Ç—å –±—Ä–æ–Ω—å (1400 —Ä—É–±)'},
      dj2:   {amount:110000,comment:'–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ DJ Lera Sound (1100 —Ä—É–±)',btnText:'–û–ø–ª–∞—Ç–∏—Ç—å –±—Ä–æ–Ω—å (1100 —Ä—É–±)'},
      mus:   {amount:150000,comment:'–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¢—Ä–∏–æ Viva Music (1500 —Ä—É–±)',btnText:'–û–ø–ª–∞—Ç–∏—Ç—å –±—Ä–æ–Ω—å (1500 —Ä—É–±)'},
      mus2:  {amount:170000,comment:'–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ó–æ–ª–æ—Ç–æ–π –°–∞–∫—Å–æ—Ñ–æ–Ω (1700 —Ä—É–±)',btnText:'–û–ø–ª–∞—Ç–∏—Ç—å –±—Ä–æ–Ω—å (1700 —Ä—É–±)'},
      agent: {amount:240000,comment:'–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞ –ò—Ä–∏–Ω–∞ MIR (2400 —Ä—É–±)',btnText:'–û–ø–ª–∞—Ç–∏—Ç—å –±—Ä–æ–Ω—å (2400 —Ä—É–±)'},
      agent2:{amount:180000,comment:'–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞ –ú–∞–∫—Å–∏–º Event (1800 —Ä—É–±)',btnText:'–û–ø–ª–∞—Ç–∏—Ç—å –±—Ä–æ–Ω—å (1800 —Ä—É–±)'}
    };
    let currentKey='ved', chatIdx=0, adminOpen=false;

    const calendars = {
      ved:   ['2025-10-15','2025-10-19','2025-10-22'],
      ved2:  ['2025-10-17','2025-10-21'],
      dj:    ['2025-10-20','2025-10-25'],
      dj2:   [],
      mus:   ['2025-10-16','2025-10-22','2025-10-24'],
      mus2:  [],
      agent: ['2025-10-18'],
      agent2:[]
    };

    function renderCalendars(){
      for(let k in calendars){
        let el=document.getElementById('cal-'+k);
        if(el) el.innerHTML = calendars[k].length ? `<b>–ó–∞–Ω—è—Ç–æ:</b> ${calendars[k].join(', ')}` : '<span style="color:deepskyblue;">–í—Å–µ –¥–∞—Ç—ã —Å–≤–æ–±–æ–¥–Ω—ã</span>';
      }
    }

    function genFreeDates(key){
      let busy = calendars[key] || [];
      let today = new Date();
      let arr=[];
      for(let i=0;i<14;i++){
        let dt=new Date(today);
        dt.setDate(dt.getDate()+i);
        let ds=dt.toISOString().slice(0,10);
        if(!busy.includes(ds)) arr.push(ds);
      }
      return arr;
    }

    function openModal(key){
      currentKey=key;
      document.getElementById('modal-pay-all').style.display='block';
      document.getElementById('paybox-tinkoff-all').style.display='none';
      document.getElementById('universalForm').reset();
      let user=JSON.parse(localStorage.getItem('user')||'{}');
      if(user.email) {
        document.getElementById('clientName').value = user.name || '';
        document.getElementById('clientEmail').value = user.email || '';
        document.getElementById('clientPhone').value = user.phone || '';
      }
      let freeDates = genFreeDates(currentKey);
      let select = document.getElementById('clientDate');
      select.innerHTML='<option>–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É</option>';
      for(let d of freeDates){
        let opt=document.createElement('option');
        opt.value=d;
        opt.innerText=d;
        select.appendChild(opt);
      }
    }

    document.getElementById('universalForm').onsubmit = function(){
      const srv=serviceList[currentKey];
      document.getElementById('payAmount').value=srv.amount;
      document.getElementById('payComment').value=srv.comment;
      document.getElementById('payBtn').innerText=srv.btnText;
      document.getElementById('payClientName').value=document.getElementById('clientName').value;
      document.getElementById('payClientEmail').value=document.getElementById('clientEmail').value;
      document.getElementById('payClientPhone').value=document.getElementById('clientPhone').value;
      let date = document.getElementById('clientDate').value;
      if(date && calendars[currentKey]) calendars[currentKey].push(date);
      renderCalendars();
      let order = {
        service: srv.comment,
        date: date,
        contact: `${document.getElementById('clientName').value} / ${document.getElementById('clientPhone').value}`,
        email: document.getElementById('clientEmail').value,
        sum: (srv.amount/100).toLocaleString()+'‚ÇΩ',
        ts: new Date().toLocaleString()
      };
      let history = JSON.parse(localStorage.getItem('order_history')||'[]');
      history.unshift(order);
      localStorage.setItem('order_history', JSON.stringify(history));
      showNotifPopup('–ó–∞—è–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞! –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ.');
    }

    function showProfileModal(){
      let user=JSON.parse(localStorage.getItem('user')||'{}');
      document.getElementById('profileModal').style.display='block';
      let orders = JSON.parse(localStorage.getItem('order_history')||'[]');
      let historyBlock = '';
      if (orders.length) {
        historyBlock = '<table class="order-history"><tr><th>–£—Å–ª—É–≥–∞</th><th>–î–∞—Ç–∞</th><th>–°—É–º–º–∞</th><th>–û—Ç–∑—ã–≤</th><th>–ß–∞—Ç</th></tr>' +
          orders.map((o,idx)=>
            `<tr>
              <td>${o.service}</td>
              <td style="color:#efe;"><b>${o.date||''}</b></td>
              <td style="text-align:center;">${o.sum}</td>
              <td>${o.review ? `<span style="color:gold;">${o.review}</span>` : `<button onclick="writeReview(${idx})" style="padding:5px 10px;font-size:0.9em;border:none;background:gold;color:#23253a;border-radius:4px;">–û—Ç–∑—ã–≤</button>`}</td>
              <td><button class="chat-btn" onclick="openChat(${idx})">–ß–∞—Ç</button></td>
            </tr>`
          ).join('') +
        '</table>';
      } else {
        historyBlock = "<div style='margin-top:18px;color:#FFD700;text-align:center;font-size:1em;'>–ü–æ–∫–∞ –Ω–µ—Ç –Ω–∏ –æ–¥–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞</div>";
      }
      if(user.email){
        document.getElementById('authBlock').innerHTML = `
          <h2 style='color:gold;text-align:center;'>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h2>
          <div style='color:#fff;background:#212244;border-radius:12px;padding:18px;line-height:1.68;margin-bottom:17px;'>
            <b>–ò–º—è:</b> ${user.name||''}<br>
            <b>Email:</b> ${user.email||''}<br>
            <b>–¢–µ–ª–µ—Ñ–æ–Ω:</b> ${user.phone||''}
          </div>
          <button onclick="logoutUserMain()" style='width:100%;background:#222;color:gold;border-radius:7px;padding:11px;font-weight:bold;margin-top:5px;border:none;'>–í—ã–π—Ç–∏</button>
          <div style='margin-top:24px;color:#FFD700;text-align:center;font-size:1.1em;'>–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤</div>
          ${historyBlock}
        `;
      }else{
        document.getElementById('authBlock').innerHTML = `
          <h2 style='color:gold;text-align:center;'>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞</h2>
          <input type="text" id="regName" placeholder="–ò–º—è" style="width:98%;margin-bottom:9px;padding:9px;">
          <input type="email" id="regEmail" placeholder="E-mail" style="width:98%;margin-bottom:9px;padding:9px;">
          <input type="tel" id="regPhone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" style="width:98%;margin-bottom:9px;padding:9px;">
          <input type="password" id="regPass" placeholder="–ü–∞—Ä–æ–ª—å" style="width:98%;margin-bottom:14px;padding:9px;">
          <button onclick="registerUserMain()" style="width:100%;background:gold;color:#23253a;border:none;border-radius:8px;padding:10px;">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
          <div style='text-align:right;color:#FFD700;margin-bottom:8px;'>–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a href='#' onclick="showLoginMain();return false;" style='color:#63d6ff;'>–í–æ–π—Ç–∏</a></div>
        `;
      }
    }

    function writeReview(idx){
      let review = prompt('–û—Å—Ç–∞–≤—å—Ç–µ –æ—Ç–∑—ã–≤ –∏ –æ—Ü–µ–Ω–∫—É (1-5):');
      if(review){
        let history = JSON.parse(localStorage.getItem('order_history')||'[]');
        history[idx].review = review;
        localStorage.setItem('order_history', JSON.stringify(history));
        showProfileModal();
        updateRatings();
      }
    }

    function openChat(idx){
      chatIdx=idx;
      let history=JSON.parse(localStorage.getItem('order_history')||'[]');
      let dialog = history[idx].chat || [];
      document.getElementById('chatModal').style.display='block';
      renderChat(dialog);
    }

    function renderChat(dialog){
      let box='';
      for(let m of dialog){
        box += `<div style="margin-bottom:6px;"><b>${m.from==='client'?'–í—ã':'–ê—Ä—Ç–∏—Å—Ç'}:</b> ${m.text} <span style="color:#FFD700;font-size:0.92em;">${m.ts||''}</span></div>`;
      }
      document.getElementById('chatBox').innerHTML=box||'<div style="color:#FFD700;">–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π. –ù–∞—á–Ω–∏—Ç–µ –¥–∏–∞–ª–æ–≥!</div>';
    }

    function sendChatMsg(){
      let txt=document.getElementById('chatMsg').value.trim();
      if(!txt)return;
      let history=JSON.parse(localStorage.getItem('order_history')||'[]');
      let dialog = history[chatIdx].chat || [];
      dialog.push({from:'client',text:txt,ts:new Date().toLocaleTimeString()});
      history[chatIdx].chat = dialog;
      localStorage.setItem('order_history', JSON.stringify(history));
      renderChat(dialog);
      document.getElementById('chatMsg').value='';
      showNotifPopup('–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∞—Ä—Ç–∏—Å—Ç—É!');
    }

    function hideChatModal(){document.getElementById('chatModal').style.display='none';}
    function hideProfileModal(){document.getElementById('profileModal').style.display='none';}

    function showLoginMain(){
      document.getElementById('authBlock').innerHTML = `
        <h2 style='color:gold;text-align:center;'>–í—Ö–æ–¥</h2>
        <input type="email" id="loginEmail" placeholder="E-mail" style="width:98%;margin-bottom:11px;padding:9px;">
        <input type="password" id="loginPass" placeholder="–ü–∞—Ä–æ–ª—å" style="width:98%;margin-bottom:14px;padding:9px;">
        <button onclick="loginUserMain()" style="width:100%;background:gold;color:#23253a;border:none;border-radius:8px;padding:10px;">–í–æ–π—Ç–∏</button>
        <div style='text-align:right;color:#FFD700;margin-bottom:8px;'>–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href='#' onclick="showProfileModal();return false;" style='color:#63d6ff;'>–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a></div>
      `;
    }

    function registerUserMain(){
      let name=document.getElementById('regName').value.trim();
      let email=document.getElementById('regEmail').value.trim();
      let phone=document.getElementById('regPhone').value.trim();
      let pass=document.getElementById('regPass').value;
      if(name&&email&&phone&&pass){
        localStorage.setItem('user',JSON.stringify({name,email,phone,pass}));
        updateProfileBtn();
        showProfileModal();
        alert("–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!");
      }
    }

    function loginUserMain(){
      let email=document.getElementById('loginEmail').value.trim();
      let pass=document.getElementById('loginPass').value;
      let user=JSON.parse(localStorage.getItem('user')||'{}');
      if(user.email===email && user.pass===pass){
        updateProfileBtn();
        showProfileModal();
      }else{
        alert('–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π e-mail –∏–ª–∏ –ø–∞—Ä–æ–ª—å!');
      }
    }

    function logoutUserMain(){
      localStorage.removeItem('user');
      updateProfileBtn();
      showProfileModal();
    }

    function updateProfileBtn(){
      let user=JSON.parse(localStorage.getItem('user')||'{}');
      document.getElementById('profileBtn').innerText = user.name ? ('üë§ '+user.name) : '–í–æ–π—Ç–∏';
    }

    function showNotifPopup(msg){
      let el=document.getElementById('popupNotif');
      el.innerText=msg; el.style.display='block';
      setTimeout(function(){el.style.display='none';},2600);
    }

    function exportAllCSV(){
      let history=JSON.parse(localStorage.getItem('order_history')||'[]');
      if(!history.length){alert('–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞');return;}
      let csv = "–£—Å–ª—É–≥–∞,–î–∞—Ç–∞,–°—É–º–º–∞,–ö–æ–Ω—Ç–∞–∫—Ç,Email,–û—Ç–∑—ã–≤\n";
      for(let order of history){
        csv += `"${order.service}","${order.date}","${order.sum}","${order.contact}","${order.email}","${order.review||''}"\n`;
      }
      let blob = new Blob([csv],{type:'text/csv'});
      let link = document.createElement('a');
      link.href=URL.createObjectURL(blob);
      link.download="orders_all.csv";
      document.body.appendChild(link); link.click(); document.body.removeChild(link);
    }

    function updateRatings(){
      const keys = {ved:'–û–ª—å–≥–∞',ved2:'–î–º–∏—Ç—Ä–∏–π',dj:'Alex',dj2:'Lera',mus:'Viva',mus2:'–°–∞–∫—Å–æ—Ñ–æ–Ω',agent:'–ò—Ä–∏–Ω–∞',agent2:'–ú–∞–∫—Å–∏–º'};
      let history=JSON.parse(localStorage.getItem('order_history')||'[]');
      let ratings={};
      for(let k in keys) ratings[k]=[];
      for(let o of history){
        for(let k in keys)
          if(o.service && o.service.indexOf(keys[k])!==-1 && o.review) ratings[k].push(+(/\d/.test(o.review)?o.review.match(/\d+/)[0]:5));
      }
      for(let k in keys){
        let st = ratings[k], avg = st.length?(st.reduce((a,b)=>a+b,0)/st.length):0;
        let s = st.length ? ("‚òÖ".repeat(Math.round(avg)) + "‚òÜ".repeat(5-Math.round(avg)) + " ("+avg.toFixed(1)+")") : "–ù–µ—Ç –æ—Ü–µ–Ω–æ–∫";
        let el=document.getElementById('star-'+k);
        if(el) el.innerHTML=s;
      }
    }

    function toggleTheme(){
      if(document.body.style.background==="rgb(38, 45, 71)" || document.body.style.background==="#262D47"){
        document.body.style.background="#FFF";
        document.body.style.color="#23253a";
        document.getElementById('themeWarn').innerText="–°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ –∞–∫—Ç–∏–≤–Ω–∞!";
      } else {
        document.body.style.background="#262D47";
        document.body.style.color="#fff";
        document.getElementById('themeWarn').innerText="–¢–µ–º–Ω–∞—è —Ç–µ–º–∞ –∞–∫—Ç–∏–≤–Ω–∞!";
      }
      setTimeout(()=>{document.getElementById('themeWarn').innerText='';},1800);
    }

    function showAdminPanel(){
      if(adminOpen) return;
      adminOpen=true;
      let orders = JSON.parse(localStorage.getItem('order_history')||'[]');
      let html = "<h2 style='color:gold;text-align:center;'>–ê–¥–º–∏–Ω–∫–∞: –≤—Å–µ –∑–∞–∫–∞–∑—ã</h2>";
      html += "<div style='margin-bottom:9px'><button class='exp-btn' onclick='exportAllCSV()'>–≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –∑–∞–∫–∞–∑–æ–≤</button>";
      html += "<button class='admin-btn' onclick='sendMassNotif()'>–ú–∞—Å—Å–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞</button></div>";
      html += "<table class='order-history'><tr><th>N</th><th>Service</th><th>Date</th><th>Sum</th><th>Contact</th><th>Email</th></tr>";
      for(let i=0;i<orders.length;i++){
        let o=orders[i];
        html+=`<tr>
          <td>${i+1}</td>
          <td>${o.service||''}</td>
          <td>${o.date||''}</td>
          <td>${o.sum||''}</td>
          <td>${o.contact||''}</td>
          <td>${o.email||''}</td>
        </tr>`;
      }
      html+="</table>";
      let dlg = document.createElement('div');
      dlg.id="adminDialog";
      dlg.style="position:fixed;top:4vw;left:50vw;transform:translateX(-50%);z-index:53000;background:#262d47;padding:29px 26px;border-radius:18px;box-shadow:0 12px 48px #181A2B;color:#FFD700;max-width:90vw;max-height:80vh;overflow:auto;";
      dlg.innerHTML = html + "<div style='text-align:center;margin-top:18px;'><button onclick='closeAdminPanel()' class='admin-btn'>–ó–∞–∫—Ä—ã—Ç—å –∞–¥–º–∏–Ω–∫—É</button></div>";
      document.body.appendChild(dlg);
    }

    function closeAdminPanel(){
      adminOpen=false;
      let ad=document.getElementById('adminDialog');
      if(ad)ad.remove();
    }

    function sendMassNotif(){
      showNotifPopup('–ú–∞—Å—Å–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º!');
    }

    window.onload = function(){ updateProfileBtn(); renderCalendars(); updateRatings(); }
  </script>
</body>
</html>
